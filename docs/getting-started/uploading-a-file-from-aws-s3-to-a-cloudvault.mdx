---
sidebar_position: 1
---
import Tabs from '@theme/Tabs';
import TabItem from '@theme/TabItem';

import Authentication from '../_partials/_authentication.mdx';

# Uploading a file from AWS S3 to a Cloud Vault

For specific information on [Cloud Vaults](/docs/cloudvaults/) we have a dedicated page [here](/docs/cloudvaults/).

<Authentication/>

## Create a Cloud Vault

To upload a file to the InfoSum Platform, you will need a Cloud Vault to hold the file. You can create a Cloud Vault using the following command which you will need to provide;

- A non-conflicting name for the Cloud Vault as `name`
- A description of the Cloud Vault as `description`
- The region you want the Cloud Vault to reside in as `region`

<Tabs>
  <TabItem value="curl" label="cURL" default>

```bash
curl --location --request POST 'https://api.integration.k8s.is/api/v2/filevaults' \
--header "Authorization: $INFOSUM_API_KEY" \
--header 'Content-Type: application/json' \
--data-raw '{
  "name": "a-new-cloud-vault",
  "description": "A new cloud vault to store files",
  "region": "AWS_EU_WEST_2"
}'
```
  </TabItem>
</Tabs>

## Importing a file

Once you have a Cloud Vault you will need to run an import process from your storage location to the Cloud Vault.

### Create an Import Connector

The first step is to set up an `Import Connector Config` (or `ICC` for short), to manage the connection between your AWS S3 or Google GCS and the InfoSum Platform.

For example, we will move a file from AWS S3 to Cloud Vault, so the `config` object would need;

- A name for the import connector as `name`
- A description of what the connector is doing as `description` (this is optional)
- An S3 connection object in `s3_connector`
    - The name of the AWS S3 bucket is `bucket`
    - A prefix for files under `prefix`
    - An array of filenames or patterns that identify files under `filenames`
    - An authentication object under `cross_account` with
        - A valid AWS ARN to assume as `user_arn`
        - The name of the session is `session_name`

<Tabs>
  <TabItem value="curl" label="cURL" default>

```bash
curl --location --request POST 'https://api.integration.k8s.is/api/v2/bunker/import/import-connector-configs' \
--header "Authorization: $INFOSUM_API_KEY" \
--header 'Content-Type: application/json' \
--data-raw '{
  "config": {
    "name": "AWS S3 migration",
    "description": "Moving from remote to Cloud Vault",
    "s3_connector": {
      "bucket": "name-of-the-s3-bucket",
      "prefix": "",
      "cross_account": {
        "user_arn": "arn:aws:iam::XXXXXXXXXXXX:role/RoleName",
        "session_name": "nameofthesession"
      },
      "filenames": [
        "*.csv"
      ]
    }
  }
}'
```
  </TabItem>
</Tabs>

### Create an Import

After you have the connector, you will need an `Import` to execute the import. Your `import` config will connect your `import-connector-config` to your Cloud Vault.

The necessary information for the `import` is:

- A name for the task as `name`
- An optional `description`
- The Import Connector Config ID from the previous request under `icc_id`
- The Cloud Vault ID created at the beginning as the `destination_id`
- The `data_filter` contains the `filter`, which is used to further filter files alllowed by the `ICC`

<Tabs>
  <TabItem value="curl" label="cURL" default>

```bash
curl --location --request POST 'https://api.integration.k8s.is/api/v2/bunker/import/imports' \
--header "Authorization: $INFOSUM_API_KEY" \
--header 'Content-Type: application/json' \
--data-raw '{
  "import": {
    "name": "AWS S3 to CloudVault task",
    "description": "Moving just CSVs",
    "icc_id": "The ICC ID from the previous request",
    "destination_id": "The CloudVault ID from before",
    "data_filter": {
      "filter": [
        "our-csv-file.csv"
      ]
    }
  }
}'
```
  </TabItem>
</Tabs>